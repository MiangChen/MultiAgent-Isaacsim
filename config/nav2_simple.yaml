#planner_server:
#  ros__parameters:
#    use_sim_time: true
#    global_frame: "map"
#    planner_plugins: ["GridBased"]
#    publish_grid_map: true
#    GridBased:
##      plugin: "nav2_navfn_planner/NavfnPlanner"
#      plugin: "nav2_straightline_planner/StraightLine"
#      tolerance: 1.0
#      use_astar: true
#      allow_unknown: true
#
#lifecycle_manager:
#  ros__parameters:
#    use_sim_time: true
#    autostart: true
#    node_names: ['planner_server']


# =================================================================
#            最终的、修复了 QoS 问题的 Nav2 Planner 配置
# =================================================================
planner_server:
  ros__parameters:
    use_sim_time: true

    costmap:
      plugin: "nav2_costmap_2d::Costmap2DROS"
      global_frame: "map"
      robot_base_frame: "base_link"
      use_sim_time: true
      robot_radius: 0.2
      resolution: 0.1
      track_unknown_space: true

      plugins: ["static_layer"]
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        # 【决定性的修复】
        # 这个参数告诉 static_layer 使用 TRANSIENT_LOCAL QoS 来订阅地图。
        # 它现在可以接收到您发布的“公告板”式的地图了。
        map_subscribe_transient_local: True

      # 保持开启，用于在 RViz2 中调试
      always_publish_full_costmap: true

    # 规划器插件的配置保持不变
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      tolerance: 1.0
      use_astar: true
      allow_unknown: true

# Lifecycle Manager 的配置保持不变
lifecycle_manager:
  ros__parameters:
    use_sim_time: true
    autostart: true
    node_names: ['planner_server']